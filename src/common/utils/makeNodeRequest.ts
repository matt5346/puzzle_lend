/* eslint-disable no-async-promise-executor */
/* eslint-disable no-await-in-loop */
import axios from 'axios';

const nodes = [
  'https://nodes-puzzle.wavesnodes.com',
  'https://wavesducks.wavesnodes.com',
  'https://nodes.swop.fi',
  'https://nodes.wavesnodes.com',
];
const makeNodeRequest = (request: string): Promise<any> => {
  return new Promise(async (resolve, reject) => {
    let nodeIndex = 0;
    let success = false;
    while (!success) {
      const url = nodes[nodeIndex] + request;
      try {
        const response = await axios.get(url);
        success = true;
        resolve(response);
      } catch (reason) {
        if (nodeIndex === nodes.length - 1) {
          success = true;
          reject(reason);
        } else {
          nodeIndex += 1;
        }
      }
    }
  });
};

export default makeNodeRequest;
